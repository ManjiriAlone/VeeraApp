<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Light Intensity Control</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(to bottom, #8bc34a, #dcedc8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      position: relative;
      overflow-x: hidden;
      overflow-y: auto;
      padding: 20px;
      padding-bottom: 40px;
    }

    /* Clip arts */
    .clip-top {
      position: absolute;
      top: 10px;
      left: 20px;
      width: 140px;
      opacity: 0.9;
      animation: float 3s ease-in-out infinite;
    }

    .clip-bottom {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 150px;
      opacity: 0.9;
      animation: float 4s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    /* Top-right menu */
    .top-icons {
      position: absolute;
      top: 20px;
      right: 30px;
      display: flex;
      gap: 15px;
      z-index: 100;
    }

    .top-icons img {
      width: 55px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .top-icons img:hover {
      transform: scale(1.1) rotate(5deg);
    }

    /* Title */
    h1 {
      margin-top: 60px;
      background: rgba(255,255,255,0.3);
      padding: 12px 35px;
      border-radius: 12px;
      font-size: 2rem;
      font-weight: bold;
      color: #fff;
      text-shadow: 1px 1px 2px #000;
      animation: slideDown 0.6s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Content section */
    .content {
      margin-top: 30px;
      display: flex;
      align-items: flex-start;
      gap: 30px;
      z-index: 10;
    }

    .left-section {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .board {
      width: 420px;
      animation: fadeIn 0.8s ease-out 0.3s both;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    /* Sensor Data Boxes */
    .sensor-boxes {
      display: flex;
      gap: 15px;
    }

    .sensor-box {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 15px;
      padding: 15px 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      min-width: 190px;
      animation: fadeIn 0.8s ease-out 0.5s both;
    }

    .sensor-label {
      font-size: 0.9rem;
      color: #666;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .sensor-value {
      font-size: 2rem;
      font-weight: bold;
      color: #2196F3;
    }

    .sensor-unit {
      font-size: 0.8rem;
      color: #999;
      margin-left: 5px;
    }

    .right-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    /* Room Visualization */
    .room-container {
      position: relative;
      width: 300px;
      height: 250px;
      background: linear-gradient(to bottom, #4a90e2, #87ceeb);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      transition: all 0.5s ease;
      animation: fadeIn 0.8s ease-out 0.4s both;
    }

    .room-container.dark {
      background: linear-gradient(to bottom, #1a1a2e, #16213e);
    }

    .room-window {
      position: absolute;
      top: 30px;
      left: 40px;
      width: 80px;
      height: 80px;
      background: rgba(255, 255, 255, 0.3);
      border: 4px solid #fff;
      border-radius: 8px;
      transition: all 0.5s ease;
    }

    .room-container.dark .room-window {
      background: rgba(50, 50, 80, 0.5);
      border-color: #555;
    }

    .room-light {
      position: absolute;
      top: 20px;
      right: 50px;
      width: 50px;
      height: 50px;
      background: radial-gradient(circle, rgba(255,255,0,0) 0%, rgba(255,255,0,0) 100%);
      border-radius: 50%;
      transition: all 0.5s ease;
    }

    .room-light::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 30px;
      height: 30px;
      background: #666;
      border-radius: 50%;
      transition: all 0.5s ease;
    }

    .room-container.dark .room-light {
      background: radial-gradient(circle, rgba(255,255,0,0.8) 0%, rgba(255,255,0,0) 70%);
      box-shadow: 0 0 40px rgba(255,255,0,0.6);
    }

    .room-container.dark .room-light::before {
      background: #ffeb3b;
      box-shadow: 0 0 20px rgba(255,255,0,0.8);
    }

    .room-floor {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 40px;
      background: rgba(139, 69, 19, 0.6);
      transition: all 0.5s ease;
    }

    .room-container.dark .room-floor {
      background: rgba(70, 35, 10, 0.8);
    }

    .speech {
      background: #00cfff;
      color: #000;
      padding: 20px;
      border-radius: 20px;
      font-size: 1.2rem;
      max-width: 450px;
      position: relative;
      min-height: 180px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      animation: fadeIn 0.8s ease-out 0.6s both;
    }

    .speech::after {
      content: "";
      position: absolute;
      right: -20px;
      bottom: 30px;
      border-width: 12px;
      border-style: solid;
      border-color: transparent transparent transparent #00cfff;
    }

    .typewriter {
      display: inline;
      border-right: 2px solid #000;
      animation: blink 0.7s step-end infinite;
    }

    @keyframes blink {
      50% { border-color: transparent; }
    }

    .lion {
      width: 280px;
      height: 280px;
      margin-top: 20px;
      object-fit: contain;
      filter: drop-shadow(0 4px 10px rgba(0,0,0,0.2));
      animation: fadeIn 0.8s ease-out 0.7s both;
    }

    /* Continue Button */
    .continue-btn {
      margin-top: 30px;
      background: #fff;
      color: #000;
      font-weight: bold;
      font-size: 1.3rem;
      padding: 14px 40px;
      border-radius: 12px;
      cursor: pointer;
      border: none;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      animation: fadeIn 0.8s ease-out 0.9s both;
    }

    .continue-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }

    .continue-btn img {
      width: 30px;
      animation: bounce 1s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateX(0); }
      50% { transform: translateX(5px); }
    }

    /* Responsive Design */
    @media screen and (max-width: 1200px) {
      .content {
        flex-direction: column;
        align-items: center;
      }

      .left-section {
        align-items: center;
      }

      .board {
        width: 320px;
      }

      .speech {
        max-width: 380px;
        min-height: 160px;
      }

      .lion {
        width: 200px;
        height: 200px;
      }

      .room-container {
        width: 280px;
        height: 220px;
      }
    }

    @media screen and (max-width: 768px) {
      body {
        padding: 10px;
        padding-bottom: 30px;
      }

      h1 {
        margin-top: 70px;
        font-size: 1.4rem;
        padding: 10px 25px;
      }

      .clip-top {
        width: 90px;
        top: 5px;
        left: 10px;
      }

      .clip-bottom {
        width: 100px;
        bottom: 10px;
        right: 10px;
      }

      .top-icons {
        top: 12px;
        right: 12px;
        gap: 8px;
      }

      .top-icons img {
        width: 40px;
      }

      .content {
        margin-top: 15px;
        gap: 15px;
      }

      .board {
        width: 260px;
      }

      .sensor-boxes {
        flex-direction: row;
        gap: 8px;
        width: 100%;
        flex-wrap: wrap;
      }

      .sensor-box {
        flex: 1;
        min-width: 120px;
        padding: 10px 12px;
      }

      .sensor-label {
        font-size: 0.75rem;
      }

      .sensor-value {
        font-size: 1.4rem;
      }

      .room-container {
        width: 220px;
        height: 180px;
      }

      .room-window {
        width: 55px;
        height: 55px;
        top: 20px;
        left: 25px;
      }

      .room-light {
        width: 38px;
        height: 38px;
        right: 35px;
      }

      .room-light::before {
        width: 23px;
        height: 23px;
      }

      .speech {
        font-size: 0.95rem;
        padding: 14px;
        max-width: 90%;
        min-height: 130px;
      }

      .lion {
        width: 160px;
        height: 160px;
        margin-top: 8px;
      }

      .continue-btn {
        font-size: 1rem;
        padding: 11px 28px;
        margin-top: 15px;
        margin-bottom: 20px;
      }

      .continue-btn img {
        width: 24px;
      }
    }

    @media screen and (max-width: 480px) {
      h1 {
        margin-top: 65px;
        font-size: 1.1rem;
        padding: 8px 18px;
      }

      .board {
        width: 220px;
      }

      .sensor-boxes {
        flex-direction: column;
        gap: 8px;
      }

      .sensor-box {
        min-width: 100%;
      }

      .room-container {
        width: 180px;
        height: 150px;
      }

      .room-window {
        width: 45px;
        height: 45px;
        top: 18px;
        left: 20px;
      }

      .room-light {
        width: 32px;
        height: 32px;
        right: 28px;
        top: 15px;
      }

      .room-light::before {
        width: 18px;
        height: 18px;
      }

      .speech {
        font-size: 0.85rem;
        padding: 12px;
        min-height: 110px;
      }

      .lion {
        width: 140px;
        height: 140px;
      }

      .continue-btn {
        font-size: 0.95rem;
        padding: 10px 24px;
        margin-bottom: 20px;
      }

      .sensor-value {
        font-size: 1.3rem;
      }

      .clip-top, .clip-bottom {
        opacity: 0.6;
      }
    }
  </style>
</head>
<body>
  <!-- Top-left clip art -->
  <img src="../../assets/images/clip-top.png" alt="Top Clip" class="clip-top">

  <!-- Top-right icons -->
  <div class="top-icons">
    <img src="../../assets/icons/home.png" alt="Home" onclick="goHome()">
    <img src="../../assets/icons/achievements.png" alt="Achievements" onclick="goAchievements()">
    <img src="../../assets/icons/logout.png" alt="Back" onclick="goBack()">
  </div>

  <!-- Title -->
  <h1>Light Intensity Control</h1>

  <!-- Content -->
  <div class="content">
    <div class="left-section">
      <img src="../../assets/images/board.png" alt="Board" class="board">
      
      <!-- Sensor Data Boxes -->
      <div class="sensor-boxes">
        <div class="sensor-box">
          <div class="sensor-label">💡 LDR Sensor</div>
          <div class="sensor-value" id="ldrValue">0<span class="sensor-unit">lux</span></div>
        </div>
        <div class="sensor-box">
          <div class="sensor-label">🔊 Sound Sensor</div>
          <div class="sensor-value" id="soundValue">0<span class="sensor-unit">dB</span></div>
        </div>
      </div>
    </div>

    <div class="right-section">
      <!-- Room Visualization -->
      <div class="room-container" id="room">
        <div class="room-window"></div>
        <div class="room-light"></div>
        <div class="room-floor"></div>
      </div>

      <div class="speech">
        <span id="typewriterText" class="typewriter"></span>
      </div>
      <img src="../../assets/images/lion.gif" alt="Lion" class="lion" id="lion">
    </div>
  </div>

  <!-- Continue button -->
  <button class="continue-btn" onclick="goNext()">
    CONTINUE <img src="../../assets/icons/arrow.png" alt="Arrow">
  </button>

  <!-- Bottom-right clip art -->
  <img src="../../assets/images/clip-bottom.png" alt="Bottom Clip" class="clip-bottom">

  <!-- Audio -->
  <audio id="voice" autoplay>
    <source src="../../assets/voice/VOICE OVER PAGE 8.mp3" type="audio/mpeg">
  </audio>

  <script>
    const audio = document.getElementById("voice");
    const lion = document.getElementById("lion");
    const typewriterText = document.getElementById("typewriterText");
    const room = document.getElementById("room");
    const ldrValueEl = document.getElementById("ldrValue");
    const soundValueEl = document.getElementById("soundValue");

    // Typewriter effect
    const fullText = "🌞 Hello sunshine!\nIn this experiment, we'll see how light around us changes the brightness of a bulb.\nMeet our special sensor — the LDR, or Light Dependent Resistor.\nIt can see how bright or dark your surroundings are.\nWhen it's dark, the kit automatically turns ON the light, and when it's bright, it turns OFF.\nThat's how smart streetlights work! 🌃\nLet's see if your Veera Kit can light up the night!";
    
    let index = 0;
    function typeWriter() {
      if (index < fullText.length) {
        const char = fullText.charAt(index);
        if (char === '\n') {
          typewriterText.innerHTML += '<br>';
        } else {
          typewriterText.textContent += char;
        }
        index++;
        setTimeout(typeWriter, 30);
      } else {
        typewriterText.classList.remove('typewriter');
      }
    }

    // Start typewriter after short delay
    setTimeout(typeWriter, 500);

    // Try autoplay
    audio.play().then(() => {
      lion.src = "../../assets/images/lion.gif";
    }).catch(() => {
      console.log("Autoplay blocked, waiting for user interaction...");
      document.body.addEventListener("click", () => {
        audio.play();
      }, { once: true });
    });

    // When audio starts
    audio.addEventListener("play", () => {
      lion.src = "../../assets/images/lion.gif";
    });

    // When audio ends
    audio.addEventListener("ended", () => {
      lion.src = "../../assets/images/lion.gif";
    });

    // Simulate sensor data updates (replace with actual kit data)
    let ldrValue = 50;
    let soundValue = 30;

    function updateSensors() {
      // Update display
      ldrValueEl.innerHTML = ldrValue + '<span class="sensor-unit">lux</span>';
      soundValueEl.innerHTML = soundValue + '<span class="sensor-unit">dB</span>';

      // Update room darkness based on LDR
      if (ldrValue < 30) {
        room.classList.add('dark');
      } else {
        room.classList.remove('dark');
      }
    }

    // Simulate sensor changes
    setInterval(() => {
      ldrValue = Math.floor(Math.random() * 100);
      soundValue = Math.floor(Math.random() * 80);
      updateSensors();
    }, 2000);

    // Initial update
    updateSensors();

    // Navigation functions
    function goHome() {
      window.location.href = "../welcome.html";
    }
    function goAchievements() {
      window.location.href = "../page4.html";
    }
    function goBack() {
      window.history.back();
    }

    document.addEventListener("DOMContentLoaded", () => {
      // Tell kit which experiment this page is
      if (window.serialAPI && window.serialAPI.send) {
        window.serialAPI.send("SET_EXPERIMENT_2");
      }

      // Listen for kit navigation and sensor data
      if (window.serialAPI && window.serialAPI.onData) {
        window.serialAPI.onData((data) => {
          if (data.type === "navigate" && data.target) {
            console.log("🔀 Navigating to:", data.target);
            window.location.href = data.target;
          }
          
          // Handle sensor data from kit
          if (data.type === "sensor") {
            if (data.ldr !== undefined) {
              ldrValue = data.ldr;
            }
            if (data.sound !== undefined) {
              soundValue = data.sound;
            }
            updateSensors();
          }
        });
      }
    });

    function goNext() {
      window.location.href = "C5E2P1.html";
    }
  </script>
  
  <script src="../backend/renderer.js"></script>
  <script src="serialmanager.js"></script>
  <script src="./backend/experimentControls.js"></script>
</body>
</html>